<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>TechOps 360</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
  <style>
    :root{
      --font:'Inter',system-ui,-apple-system,'Segoe UI',Roboto,sans-serif;
      /* Dark theme */
      --bg: radial-gradient(1200px 700px at 15% 0%, #1e3a8a 0%, transparent 60%),
            radial-gradient(1200px 700px at 100% 0%, #7c3aed 0%, transparent 60%),
            radial-gradient(1200px 800px at 50% 100%, #ec4899 0%, transparent 60%),
            #0b1221;
      --card-bg: rgba(10,14,25,.9);
      --card-border: rgba(148,163,184,.35);
      --shadow: 0 18px 60px rgba(0,0,0,.45);
      --text:#e7ecf4; --muted:#9aa4b2;
      --pill: rgba(15,23,42,.9); --pill-border: rgba(148,163,184,.5);
      --table-head: rgba(18,24,38,.95);
      --row-alt: rgba(18,24,38,.7);
      --row-hover: rgba(37, 99, 235, .15);
      --tile-bg: rgba(12,18,30,.9);
      --accent:#f97316;

      /* severity colors */
      --p1: #ef4444;          /* red */
      --p2: #fb923c;          /* orange */
      --p3: #facc15;          /* dark yellow */
      --p4: #b45309;          /* brown */

      --conc-equal-height: 370px; /* matched height for Ops Calendar & Concurrency */
    }
    [data-theme="light"]{
      --bg: radial-gradient(1200px 700px at 15% 0%, #dbeafe 0%, transparent 60%),
            radial-gradient(1200px 700px at 100% 0%, #fde68a 0%, transparent 60%),
            radial-gradient(1200px 800px at 50% 100%, #fef3c7 0%, transparent 60%),
            #f8fafc;
      --card-bg: rgba(255,255,255,.94);
      --card-border: rgba(2,6,23,.12);
      --shadow: 0 18px 50px rgba(2, 6, 23, .08);
      --text:#0f172a; --muted:#475569;
      --pill: rgba(255,255,255,.95); --pill-border: rgba(2,6,23,.12);
      --table-head: rgba(248,250,252,.95);
      --row-alt: rgba(248,250,252,.82);
      --row-hover: rgba(2, 132, 199, .08);

      /* keep severity readable */
      --p1: #b91c1c;
      --p2: #c2410c;
      --p3: #a16207;
      --p4: #78350f;
    }

    *{box-sizing:border-box}
    body{margin:0;font-family:var(--font);color:var(--text);background:var(--bg);background-attachment:fixed}
    .top{display:flex;align-items:center;justify-content:space-between;padding:16px 22px;position:sticky;top:0;z-index:40;backdrop-filter:blur(14px);background:linear-gradient(to bottom, rgba(12,18,30,.7), rgba(12,18,30,.35), transparent);border-bottom:1px solid var(--card-border)}
    .brand{display:flex;gap:12px;align-items:center}
    .logo{width:40px;height:28px;border-radius:10px;background:#020617;display:grid;place-items:center;box-shadow:inset 0 0 0 1px rgba(255,255,255,.05)}
    .title{font-weight:800;letter-spacing:.2px}
    .sub{font-size:.86rem;color:var(--muted)}
    .pill{display:inline-flex;align-items:center;gap:8px;font-size:.8rem;color:var(--muted);padding:6px 10px;border:1px solid var(--pill-border);background:var(--pill);border-radius:999px}
    .dot{width:7px;height:7px;border-radius:999px;background:#22c55e;box-shadow:0 0 0 4px rgba(34,197,94,.25)}
    .toggle{border:1px solid var(--pill-border);background:var(--pill);border-radius:999px;padding:6px 12px;cursor:pointer;color:var(--text);font-weight:600}
    .shell{display:grid;grid-template-columns:230px 1fr 380px;gap:18px;padding:18px;max-width:1400px;margin:0 auto}
    @media(max-width:1200px){.shell{grid-template-columns:1fr}.right-col{order:3}}
    .side{background:var(--card-bg);border:1px solid var(--card-border);border-radius:18px;box-shadow:var(--shadow);padding:12px;display:flex;flex-direction:column;gap:8px}
    .side h6{margin:6px 8px;font-size:.7rem;text-transform:uppercase;letter-spacing:.08em;color:var(--muted)}
    .navbtn{display:flex;align-items:center;gap:10px;background:transparent;color:var(--muted);padding:10px 12px;border-radius:12px;border:1px solid transparent;cursor:pointer}
    .navbtn.active,.navbtn:hover{color:var(--text);border-color:var(--card-border);background:var(--row-alt)}
    .hr{height:1px;background:var(--card-border);border:none;margin:6px 0}
    .panel{display:none}
    .panel.active{display:block}
    .card{background:var(--card-bg);border:1px solid var(--card-border);border-radius:22px;box-shadow:var(--shadow);padding:14px 16px;position:relative}
    h3{margin:6px 0 10px;font-size:1.08rem}
    .grid-center{display:grid;grid-template-rows:auto auto auto;gap:16px}
    .grid-right{display:grid;grid-template-rows:auto auto;gap:16px}

    /* keep first-row cards aligned: calendar vs concurrency; second-row: total vs availability */
    .equal-h{min-height:var(--conc-equal-height);display:flex;flex-direction:column}
    .equal-h > *:last-child{margin-top:auto} /* keep footer notes at bottom if you add later */

    table{width:100%;border-collapse:collapse;font-size:.9rem}
    thead{background:var(--table-head)}
    th,td{padding:8px 10px;border-bottom:1px solid var(--card-border);text-align:left}
    tbody tr:nth-child(even){background:var(--row-alt)}
    tbody tr:hover{background:var(--row-hover)}

    .sev-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:12px}
    .sev{background:var(--tile-bg);border:1px solid var(--card-border);border-radius:14px;padding:10px;text-align:center}
    .sev h4{margin:2px 0 6px;font-size:.9rem;color:var(--muted)}
    .sev .n{font-size:1.4rem;font-weight:800}
    .sev.p1 .n{color:var(--p1)}
    .sev.p2 .n{color:var(--p2)}
    .sev.p3 .n{color:var(--p3)}
    .sev.p4 .n{color:var(--p4)}

    /* Concurrency */
    .conc-list{list-style:none;margin:8px 0 0;padding:0;display:flex;flex-direction:column;gap:8px}
    .conc-item{display:flex;align-items:center;justify-content:space-between;gap:10px;padding:8px 10px;border-radius:12px;background:var(--tile-bg);border:1px solid var(--card-border)}
    .conc-left{display:flex;align-items:center;gap:8px}
    .logo-sq{width:26px;height:26px;border-radius:7px;display:grid;place-items:center;overflow:hidden;background:#fff;border:1px solid rgba(2,6,23,.06)}
    .logo-sq img{max-width:100%;max-height:100%;object-fit:contain;display:block}
    .logo-sq.fallback{background:linear-gradient(135deg,#dbeafe,#e9d5ff);color:#111827;font-weight:800}
    .logo-sq.fallback::after{content:attr(data-initials)}
    .badge{font-size:.78rem;border:1px solid rgba(248,250,252,.35);padding:2px 8px;border-radius:999px;display:inline-flex;gap:6px;align-items:center;background:var(--pill);color:var(--text)}
    .badge .v{color:#facc15;font-weight:800}

    /* Slot machine (horizontal, persistent digits) */
    .slot-card{display:flex;flex-direction:column;align-items:center;gap:10px;padding-top:18px;padding-bottom:18px}
    .slots{display:flex;gap:10px}
    .slot{width:72px;height:92px;border-radius:14px;background:var(--tile-bg);border:1px solid var(--card-border);overflow:hidden;position:relative;box-shadow:inset 0 -10px 20px rgba(255,255,255,.03)}
    .digit-col{position:absolute;left:0;top:0;width:100%;height:920px;transition:transform 1000ms cubic-bezier(.22,1,.36,1)}
    .digit{height:92px;display:grid;place-items:center;font-weight:800;font-size:2.35rem;color:var(--text)}
    .slot-sub{font-size:.86rem;color:var(--muted);text-align:center}

    /* Gauge */
    .gauge{width:100%;height:240px;display:block}
    .g-title{margin-bottom:8px}
    .g-label{position:absolute;bottom:14px;left:20px;font-size:1.8rem;font-weight:800}

    /* Customer Stats */
    .stats-table{width:100%}
    .stats-wrap{display:flex;flex-direction:column;gap:12px}
    .detail-card{display:none;margin-top:8px}
    .detail-card.active{display:block}
    .detail-grid{display:grid;grid-template-columns:1fr 1fr;gap:12px}
    .detail-col{background:var(--tile-bg);border:1px solid var(--card-border);border-radius:14px;padding:10px}
    .tag{padding:2px 8px;border-radius:999px;border:1px solid var(--card-border);font-size:.78rem}
    .tag.warn{background:rgba(245,158,11,.12);color:#fbbf24}
    .tag.ok{background:rgba(59,130,246,.12);color:#93c5fd}

    /* Mini gauge for customer sentiment (0..1) */
    .mini-gauge{width:100%;height:110px}
    .mini-label{font-weight:800}
  </style>
</head>
<body>
  <!-- TOP -->
  <header class="top">
    <div class="brand">
      <div class="logo"><img src="image/Quickplay.jpg" alt="Quickplay" style="height:18px"></div>
      <div>
        <div class="title">TechOps 360</div>
        <div class="sub">Operational intelligence for Quickplay customers</div>
      </div>
    </div>
    <div>
      <span class="pill"><span class="dot"></span>24Ã—7 follow-the-sun</span>
      <button id="modeToggle" class="toggle" style="margin-left:8px">Light</button>
    </div>
  </header>

  <div class="shell">
    <!-- SIDE NAV -->
    <aside class="side">
      <h6>Views</h6>
      <button class="navbtn active" data-panel="panel-dashboard">Dashboard</button>
      <button class="navbtn" data-panel="panel-cust">Customer Stats</button>
      <button class="navbtn" data-panel="panel-synth">Synthetic Monitoring</button>
      <button class="navbtn" data-panel="panel-manif">Manifest Check</button>
      <button class="navbtn" data-panel="panel-handoff">Shift Handoffs</button>
      <button class="navbtn" data-panel="panel-rbac">RBAC</button>
      <button class="navbtn" data-panel="panel-issues">Issue Search</button>
      <hr class="hr">
      <div class="sub" style="padding:6px 8px">Internal view. Live: Ops calendar (Google Sheets). Others are placeholders to wire to NR/Grafana/ServiceNow.</div>
    </aside>

    <!-- CENTER PANELS -->
    <main class="panel active" id="panel-dashboard">
      <div class="grid-center">
        <!-- Ops Calendar (fixed equal height) -->
        <section class="card equal-h">
          <h3>Operations Calendar (Today)</h3>
          <table>
            <thead><tr><th>Engineer Name</th><th>Status</th><th>Shift (local time)</th></tr></thead>
            <tbody id="ops-calendar-body"><tr><td colspan="3">Loading scheduleâ€¦</td></tr></tbody>
          </table>
        </section>

        <!-- Slot machine aligned with Availability -->
        <section class="card slot-card">
          <h3 style="text-align:center">Total incidents since org inception</h3>
          <div class="slots" id="slotCounter"></div>
          <div class="slot-sub">Demo rolls like a slot machine, then settles on todayâ€™s placeholder.</div>
        </section>

        <!-- Severity below slot -->
        <section class="card">
          <h3>Incidents today</h3>
          <div class="sev-grid">
            <div class="sev p1"><h4>P1</h4><div class="n" id="p1">1</div></div>
            <div class="sev p2"><h4>P2</h4><div class="n" id="p2">3</div></div>
            <div class="sev p3"><h4>P3</h4><div class="n" id="p3">4</div></div>
            <div class="sev p4"><h4>P4</h4><div class="n" id="p4">6</div></div>
          </div>
        </section>
      </div>
    </main>

    <!-- RIGHT (on dashboard) -->
    <aside class="panel active right-col" id="panel-dashboard-right">
      <div class="grid-right">
        <section class="card equal-h">
          <h3>Customer concurrency</h3>
          <ul class="conc-list" id="concList">
            <!-- Items are created from the logos array below -->
          </ul>
        </section>

        <section class="card">
          <h3 class="g-title">Availability</h3>
          <svg id="gauge" class="gauge" viewBox="0 0 360 200">
            <defs>
              <linearGradient id="ggrad" x1="0%" y1="0%" x2="100%" y2="0%">
                <stop offset="0%" stop-color="#ef4444"/>
                <stop offset="50%" stop-color="#f59e0b"/>
                <stop offset="100%" stop-color="#22c55e"/>
              </linearGradient>
            </defs>
            <path d="M20,180 A160,160 0 0 1 340,180" stroke="rgba(148,163,184,.28)" stroke-width="18" fill="none"/>
            <path id="gArc" d="M20,180 A160,160 0 0 1 340,180" stroke="url(#ggrad)" stroke-width="18" fill="none" stroke-linecap="round" stroke-dasharray="0 503"/>
            <line id="needle" x1="180" y1="180" x2="180" y2="40" stroke="currentColor" stroke-width="4" stroke-linecap="round"/>
          </svg>
          <div class="g-label" id="gPct">0%</div>
        </section>
      </div>
    </aside>

    <!-- CUSTOMER STATS PANEL -->
    <main class="panel" id="panel-cust">
      <section class="card">
        <h3>Customer Stats â€” App Overview</h3>
        <div class="stats-wrap">
          <table class="stats-table" id="statsTable">
            <thead>
            <tr>
              <th>App</th>
              <th>iOS rating</th>
              <th>Android rating</th>
              <th>Customer sentiment (0â€“1)</th>
            </tr>
            </thead>
            <tbody id="statsBody"><tr><td colspan="4">Loadingâ€¦</td></tr></tbody>
          </table>

          <!-- Detail panel (appears on row click) -->
          <div class="detail-card card" id="detailCard">
            <h3 id="detailTitle">Details</h3>
            <div class="detail-grid">
              <div class="detail-col">
                <div style="display:grid;grid-template-columns:1fr 1fr 1fr;gap:8px">
                  <div>
                    <div class="sub">iOS rating</div>
                    <div style="font-weight:800;font-size:1.2rem" id="dIos">â€“</div>
                    <div class="sub">App Store</div>
                  </div>
                  <div>
                    <div class="sub">Android rating</div>
                    <div style="font-weight:800;font-size:1.2rem" id="dAndroid">â€“</div>
                    <div class="sub">Google Play</div>
                  </div>
                  <div>
                    <div class="sub">Sentiment</div>
                    <div style="font-weight:800;font-size:1.2rem" id="dSent">â€“</div>
                    <div class="sub">0 = negative, 1 = positive</div>
                  </div>
                </div>

                <!-- Mini sentiment gauge -->
                <svg id="miniGauge" class="mini-gauge" viewBox="0 0 220 120">
                  <defs>
                    <linearGradient id="mgrad" x1="0%" y1="0%" x2="100%" y2="0%">
                      <stop offset="0%" stop-color="#ef4444"/>
                      <stop offset="50%" stop-color="#f59e0b"/>
                      <stop offset="100%" stop-color="#22c55e"/>
                    </linearGradient>
                  </defs>
                  <path d="M10,110 A100,100 0 0 1 210,110" stroke="rgba(148,163,184,.28)" stroke-width="14" fill="none"/>
                  <path id="mArc" d="M10,110 A100,100 0 0 1 210,110" stroke="url(#mgrad)" stroke-width="14" fill="none" stroke-linecap="round" stroke-dasharray="0 314"/>
                  <line id="mNeedle" x1="110" y1="110" x2="110" y2="30" stroke="currentColor" stroke-width="4" stroke-linecap="round"/>
                </svg>
                <div class="mini-label" id="mPct">0.00</div>
              </div>

              <div class="detail-col">
                <div style="display:grid;grid-template-columns:1fr 1fr;gap:10px">
                  <div>
                    <div style="font-weight:700;margin-bottom:6px">Top positive comments</div>
                    <ul id="posList" style="list-style:none;margin:0;padding:0"></ul>
                  </div>
                  <div>
                    <div style="font-weight:700;margin-bottom:6px">Top negative comments</div>
                    <ul id="negList" style="list-style:none;margin:0;padding:0"></ul>
                  </div>
                </div>
                <div style="margin-top:10px">
                  <div style="font-weight:700;margin-bottom:6px">Attributing factors</div>
                  <div id="factorsRow" style="display:flex;flex-wrap:wrap;gap:8px"></div>
                </div>
              </div>
            </div>
          </div><!-- /detail-card -->
        </div>
      </section>
    </main>

    <!-- OTHER PANELS (placeholders but themed) -->
    <main class="panel" id="panel-synth"><section class="card"><h3>Synthetic Monitoring</h3><p class="sub">Placeholder for live checks table / charts.</p></section></main>
    <main class="panel" id="panel-manif"><section class="card"><h3>Manifest Check</h3><p class="sub">Placeholder for manifest results.</p></section></main>
    <main class="panel" id="panel-handoff"><section class="card"><h3>Shift Handoffs</h3><p class="sub">Placeholder for handoff notes.</p></section></main>
    <main class="panel" id="panel-rbac"><section class="card"><h3>RBAC</h3><p class="sub">Placeholder for roles matrix.</p></section></main>
    <main class="panel" id="panel-issues"><section class="card"><h3>Issue Search</h3><p class="sub">Placeholder for incident memory search.</p></section></main>
  </div>

  <!-- THEME TOGGLE -->
  <script>
    (function(){
      const root=document.documentElement,btn=document.getElementById('modeToggle');
      const saved=localStorage.getItem('techops-theme');
      if(saved){root.setAttribute('data-theme',saved);btn.textContent=saved==='dark'?'Light':'Dark'}
      btn.addEventListener('click',()=>{const cur=root.getAttribute('data-theme')||'dark';const next=cur==='dark'?'light':'dark';root.setAttribute('data-theme',next);btn.textContent=next==='dark'?'Light':'Dark';localStorage.setItem('techops-theme',next);});
    })();
  </script>

  <!-- MENU ROUTER -->
  <script>
    (function(){
      const nav = Array.from(document.querySelectorAll('.navbtn'));
      const panels = {
        'panel-dashboard': document.getElementById('panel-dashboard'),
        'panel-dashboard-right': document.getElementById('panel-dashboard-right'),
        'panel-cust': document.getElementById('panel-cust'),
        'panel-synth': document.getElementById('panel-synth'),
        'panel-manif': document.getElementById('panel-manif'),
        'panel-handoff': document.getElementById('panel-handoff'),
        'panel-rbac': document.getElementById('panel-rbac'),
        'panel-issues': document.getElementById('panel-issues'),
      };
      function show(id){
        Object.values(panels).forEach(p=>p.classList.remove('active'));
        if(id==='panel-dashboard'){panels['panel-dashboard'].classList.add('active');panels['panel-dashboard-right'].classList.add('active');}
        else{panels[id].classList.add('active');}
      }
      nav.forEach(btn=>{
        btn.addEventListener('click',()=>{
          nav.forEach(b=>b.classList.remove('active'));
          btn.classList.add('active');
          show(btn.dataset.panel);
        });
      });
    })();
  </script>

  <!-- SLOT MACHINE (persistent) -->
  <script>
    (function(){
      const TARGET="654432";      // demo number; wire to ServiceNow total later
      const H=92;                 // slot height (must match CSS)
      const wrap=document.getElementById('slotCounter');
      if(!wrap) return;
      wrap.innerHTML='';

      function makeCol(digit, delay){
        const slot=document.createElement('div');
        slot.className='slot';
        const col=document.createElement('div');
        col.className='digit-col';
        for(let i=0;i<10;i++){
          const e=document.createElement('div');
          e.className='digit';
          e.textContent=i;
          col.appendChild(e);
        }
        slot.appendChild(col);

        // Start after paint; animate to end; then lock at final position.
        setTimeout(()=>{
          const rounds=2+Math.floor(Math.random()*2); // 2-3 rounds
          const end = rounds*10 + Number(digit);
          col.style.transform = `translateY(-${end*H}px)`;
          col.addEventListener('transitionend', ()=>{
            // Remove transition and snap to exact digit within one reel height
            col.style.transition = 'none';
            const final = Number(digit)*H;
            col.style.transform = `translateY(-${final}px)`;
            // Force reflow to keep it
            col.getBoundingClientRect();
          }, {once:true});
        }, delay);
        return slot;
      }
      TARGET.split('').forEach((d,i)=>wrap.appendChild(makeCol(d, i*120)));
    })();
  </script>

  <!-- AVAILABILITY GAUGE -->
  <script>
    (function(){
      const targetPct=96; // demo
      const path=document.getElementById('gArc');
      const needle=document.getElementById('needle');
      const label=document.getElementById('gPct');
      const circumference=503, cx=180, cy=180, len=130;
      const start=performance.now(), dur=1200;
      const pctToDeg=p=>180-(p*1.8);
      function step(now){
        const t=Math.min(1,(now-start)/dur), eased=1-Math.pow(1-t,3), pct=targetPct*eased;
        label.textContent=Math.round(pct)+'%';
        const dash=(pct/100)*circumference; path.setAttribute('stroke-dasharray',`${dash} ${circumference-dash}`);
        const rad=pctToDeg(pct)*Math.PI/180, x2=cx+len*Math.cos(rad), y2=cy-len*Math.sin(rad);
        needle.setAttribute('x2',x2); needle.setAttribute('y2',y2);
        if(t<1) requestAnimationFrame(step);
      }
      requestAnimationFrame(step);
    })();
  </script>

  <!-- CONCURRENCY LIST (using your logo paths) -->
  <script>
    (function(){
      const logos = [
        {name:'Aha',                logo:'image/aha_Logo.png',                 val:'4.5K', initials:'Aha'},
        {name:'Philippinas Live',   logo:'image/PilipinasLive_Logo.png',       val:'1.8K', initials:'PL'},
        {name:'Cignal',             logo:'image/Cignal_Logo.png',             val:'2.4K', initials:'CG'},
        {name:'Unifi 2.0',          logo:'image/Unifi2.0_logo.png',            val:'1.1K', initials:'U2'},
        {name:'Univision',          logo:'image/Univision_logo.webp',          val:'2.0K', initials:'UV'},
        {name:'Univision Now',      logo:'image/UnivisionNow_logo.png',        val:'900',  initials:'UN'},
        {name:'Local Now',          logo:'image/LocalNow_Logo.png',            val:'700',  initials:'LN'},
        {name:'TWC (The Weather Channel)', logo:'image/TWC_Logo.png',          val:'1.6K', initials:'TWC'},
        {name:'GOTHAM',             logo:'image/GOTHAM_Logo.png',              val:'400',  initials:'GT'},
        {name:'Canela TV',          logo:'image/CanelaTV_Logo.png',            val:'800',  initials:'CL'},
      ];
      const ul = document.getElementById('concList');
      if(!ul) return;
      ul.innerHTML = '';
      logos.forEach(item=>{
        const li = document.createElement('li');
        li.className = 'conc-item';
        li.innerHTML = `
          <div class="conc-left">
            <div class="logo-sq" data-initials="${item.initials}">
              <img src="${item.logo}" alt="${item.name}" onerror="this.parentElement.classList.add('fallback');this.remove()">
            </div>
            <div>${item.name}</div>
          </div>
          <div class="badge">Live <span class="v">${item.val}</span></div>
        `;
        ul.appendChild(li);
      });
    })();
  </script>

  <!-- CUSTOMER STATS: Overview + Detail with mini gauge and comments -->
  <script>
    (function(){
      // demo dataset (consistent but realistic)
      const apps = [
        {app:'Aha', ios:4.48, android:4.61, sent:0.66,
         pos:['Great content!', 'UI is clean and fast', 'Love the originals', 'Chromecast works well', 'Smooth login'],
         neg:['Playback failed once', 'Too many updates', 'Search needs work', 'Occasional buffer on 4G', 'Confusing error messages'],
         factors:[['stream','Steady'],['buffer','Steady'],['ads','Steady'],['crash','Steady'],['slow','Worsening']]
        },
        {app:'Philippinas Live', ios:4.22, android:4.37, sent:0.54,
         pos:['Awesome live streams','Good picture quality','Affordable plans','Easy to subscribe','Stable on Wi-Fi'],
         neg:['Lag on mobile data','Too many ads','Login issues for some','Crashes on old phones','Audio out of sync sometimes'],
         factors:[['stream','Worsening'],['buffer','Worsening'],['ads','Worsening'],['crash','Steady'],['slow','Steady']]
        },
        {app:'Cignal', ios:4.36, android:4.62, sent:0.58,
         pos:['excellent ðŸ‘ŒðŸ‘','great app!','Just pay and watch very good.','Nice channels','Family loves it'],
         neg:['Keeps lagging. Premium subscription but bad service.','Worst app ever. subscription errors','Reached streaming limit','App crashes randomly','Worst customer service'],
         factors:[['stream','Worsening'],['buffer','Worsening'],['ads','Worsening'],['crash','Steady'],['slow','Steady']]
        },
        {app:'Unifi 2.0', ios:4.40, android:4.52, sent:0.63,
         pos:['New UI looks great','Playback smooth','Kids love the shows','Search improved','Downloads are quick'],
         neg:['Login timeout once','Too many prompts','Minor subtitle delay','Payment page slow','Skip intro missing'],
         factors:[['stream','Steady'],['buffer','Steady'],['ads','Steady'],['crash','Steady'],['slow','Steady']]
        },
        {app:'Univision', ios:4.30, android:4.44, sent:0.59,
         pos:['Great sports coverage','Love the telenovelas','Spanish captions accurate','Good on Roku','Nice recommendations'],
         neg:['Buffering on peak hours','Too many geo blocks','Billing confusion','App size big','Older TV app is slow'],
         factors:[['stream','Steady'],['buffer','Worsening'],['ads','Steady'],['crash','Steady'],['slow','Worsening']]
        },
        {app:'Univision Now', ios:4.18, android:4.33, sent:0.52,
         pos:['Good live TV','App works fine','Reasonable price','Family friendly','Casting is okay'],
         neg:['Freeze sometimes','Audio desync','Subscription restore bug','App needs less ads','Login not persistent'],
         factors:[['stream','Worsening'],['buffer','Worsening'],['ads','Worsening'],['crash','Steady'],['slow','Steady']]
        },
        {app:'Local Now', ios:4.10, android:4.20, sent:0.50,
         pos:['Weather section is neat','Local news works','Layout simple','Alerts helpful','Widget is useful'],
         neg:['Too many popups','Old phones crash','Playback stutters on LTE','Search limited','Some channels missing'],
         factors:[['stream','Steady'],['buffer','Steady'],['ads','Worsening'],['crash','Steady'],['slow','Steady']]
        },
        {app:'TWC (The Weather Channel)', ios:4.45, android:4.50, sent:0.65,
         pos:['Reliable forecasts','Maps are great','Fast load','No crashes','Clear UI'],
         neg:['Ads feel intrusive','Live slows sometimes','Background battery use','Heavy install size','Some alerts late'],
         factors:[['stream','Steady'],['buffer','Steady'],['ads','Worsening'],['crash','Steady'],['slow','Steady']]
        },
        {app:'GOTHAM', ios:4.05, android:4.15, sent:0.48,
         pos:['Dark theme nice','Good catalog','Fair pricing','Works on TV','Controller support'],
         neg:['Playback stops sometimes','UI not intuitive','Search weak','Bug on login','Captions small'],
         factors:[['stream','Worsening'],['buffer','Worsening'],['ads','Steady'],['crash','Steady'],['slow','Worsening']]
        },
        {app:'Canela TV', ios:4.12, android:4.25, sent:0.53,
         pos:['Latino content variety','Easy to use','Good picture','Kids enjoy it','Free channels'],
         neg:['Ad frequency high','Buffer on 3G','App restarts occasionally','Subtitle mismatch','App heavy'],
         factors:[['stream','Steady'],['buffer','Worsening'],['ads','Worsening'],['crash','Steady'],['slow','Steady']]
        },
      ];

      // Fill overview table
      const body = document.getElementById('statsBody');
      body.innerHTML = '';
      apps.forEach((a, idx)=>{
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td>${a.app}</td>
          <td>${a.ios.toFixed(2)}</td>
          <td>${a.android.toFixed(2)}</td>
          <td>${a.sent.toFixed(2)}</td>
        `;
        tr.style.cursor = 'pointer';
        tr.addEventListener('click', ()=>openDetail(idx));
        body.appendChild(tr);
      });

      // Detail panel wiring
      const card = document.getElementById('detailCard');
      const t = (id)=>document.getElementById(id);
      const mArc = t('mArc'), mNeedle = t('mNeedle'), mPct=t('mPct');

      function openDetail(i){
        const a = apps[i];
        t('detailTitle').textContent = a.app;
        t('dIos').textContent = a.ios.toFixed(2);
        t('dAndroid').textContent = a.android.toFixed(2);
        t('dSent').textContent = a.sent.toFixed(2);

        // Lists
        const pos = t('posList'), neg = t('negList'), fac = t('factorsRow');
        pos.innerHTML = ''; neg.innerHTML = ''; fac.innerHTML = '';
        a.pos.slice(0,5).forEach(s=>{ const li=document.createElement('li'); li.textContent = s; li.style.marginBottom='6px'; pos.appendChild(li); });
        a.neg.slice(0,5).forEach(s=>{ const li=document.createElement('li'); li.textContent = s; li.style.marginBottom='6px'; neg.appendChild(li); });
        a.factors.forEach(([name,state])=>{
          const span = document.createElement('span');
          span.className = 'tag ' + (state==='Worsening'?'warn':'ok');
          span.textContent = `${name} â€¢ ${state}`;
          fac.appendChild(span);
        });

        // Mini gauge animate (0..1 maps to 0..100%)
        const pct = a.sent*100;
        mPct.textContent = a.sent.toFixed(2);
        const circ = 314; // dash-length of arc
        const start = performance.now(), dur=800;
        function step(now){
          const t = Math.min(1,(now-start)/dur), eased = 1-Math.pow(1-t,3);
          const cur = pct*eased;
          const dash=(cur/100)*circ; mArc.setAttribute('stroke-dasharray',`${dash} ${circ-dash}`);
          // needle
          const cx=110, cy=110, len=70;
          const deg = 180-(cur*1.8);
          const rad = deg*Math.PI/180;
          const x2=cx+len*Math.cos(rad), y2=cy-len*Math.sin(rad);
          mNeedle.setAttribute('x2',x2); mNeedle.setAttribute('y2',y2);
          if(t<1) requestAnimationFrame(step);
        }
        requestAnimationFrame(step);

        card.classList.add('active');
        card.scrollIntoView({behavior:'smooth', block:'nearest'});
      }
    })();
  </script>

  <!-- GOOGLE SHEETS OPS CALENDAR -->
  <script src="ops-calendar.js"></script>

  <!-- Botpress Chatbot -->
  <script src="https://cdn.botpress.cloud/webchat/v1/inject.js"></script>
  <script>
    window.botpressWebChat.init({
      composerPlaceholder: "Chat with TechOps Bot",
      botConversationDescription: "Your AI assistant for TechOps 360",
      botId: "56efefce-fa7c-41e6-9846-ec36c7c6704a",
      hostUrl: "https://cdn.botpress.cloud/webchat/v1",
      messagingUrl: "https://messaging.botpress.cloud",
      clientId: "a7e5af98-3b12-4265-a9f9-6f3fcd500b93",
      lazySocket: true,
      themeName: "prism",
      botName: "TechOps Assistant",
      stylesheet: "https://webchat-styler-widgets.botpress.app/prod/v1/themes/prism.css",
      frontendVersion: "v1",
      useSessionStorage: true,
      enableConversationDeletion: true,
      theme: "prism",
      themeColor: "#2563eb"
    });
  </script>
</body>
</html>
