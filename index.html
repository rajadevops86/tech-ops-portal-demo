<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>TechOps 360 - Portal</title>

  <!-- Quickplay-style font -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">

  <style>
    :root{
      --qp-font:'Inter',system-ui,-apple-system,BlinkMacSystemFont,'Segoe UI',sans-serif;

      /* Dark defaults */
      --bg:#020617;
      --bg-card:#0b1220;
      --border-card:#1f2937;
      --text-main:#e5e7eb;
      --text-muted:#9ca3af;
      --tab-bg:#111827;
      --tab-bg-active:#0b1220;
      --tab-border:#1f2937;
      --table-header-bg:#0e1726;
      --table-header-text:#9ca3af;
      --table-row-even:#0b1220;
      --table-row-hover:#131c2d;
      --accent:#f97316;

      --header-gradient-start:#6A1B9A;
      --header-gradient-end:#FF7043;

      --needle:#ffffff; /* gauge needle (dark) */
    }
    body.light-mode{
      --bg:#E1E0FF;
      --bg-card:#ffffff;
      --border-card:#e5e7eb;
      --text-main:#111827;
      --text-muted:#4b5563;
      --tab-bg:#eef2ff;
      --tab-bg-active:#ffffff;
      --tab-border:#d1d5db;
      --table-header-bg:#f9fafb;
      --table-header-text:#4b5563;
      --table-row-even:#f9fafb;
      --table-row-hover:#f3f4f6;

      --needle:#111827; /* gauge needle (light) */
    }

    *{box-sizing:border-box}
    body{
      margin:0;
      background:var(--bg);
      color:var(--text-main);
      font-family:var(--qp-font);
      transition:background .25s,color .25s;
    }

    header{
      background:linear-gradient(90deg,var(--header-gradient-start),var(--header-gradient-end));
      color:#fff;padding:16px 20px;display:flex;align-items:center;gap:12px;position:sticky;top:0;z-index:10;
      box-shadow:0 6px 14px rgba(0,0,0,.25);
    }
    header img.logo{height:40px;border-radius:8px}
    header h1{margin:0;font-weight:800;letter-spacing:.3px}
    .theme-toggle{
      margin-left:auto;border:1px solid rgba(255,255,255,.4);background:rgba(15,23,42,.25);
      color:#fff;border-radius:999px;padding:6px 12px;cursor:pointer
    }

    .container{max-width:1200px;margin:24px auto;padding:0 16px}

    /* Tabs */
    .tabs{display:flex;gap:6px;border-bottom:1px solid rgba(148,163,184,.35)}
    .tab-button{
      background:var(--tab-bg);border:1px solid var(--tab-border);border-bottom:none;
      padding:10px 14px;border-top-left-radius:10px;border-top-right-radius:10px;color:var(--text-muted);
      cursor:pointer;font-weight:600
    }
    .tab-button.active{background:var(--tab-bg-active);color:var(--text-main);position:relative;bottom:-1px;border-color:var(--border-card)}
    .tab-content{display:none;background:var(--bg-card);border:1px solid var(--border-card);border-radius:16px;padding:18px;margin-top:-1px;box-shadow:0 12px 30px rgba(0,0,0,.35)}
    .tab-content.active{display:block}

    h2{margin:0 0 10px 0;font-size:1.4rem}
    .meta-note{margin:.5rem 0 0 0;color:var(--text-muted);font-size:.9rem}

    /* Global tables */
    table{width:100%;border-collapse:collapse;font-size:.92rem}
    thead{background:var(--table-header-bg);color:var(--table-header-text)}
    th,td{padding:10px;border-bottom:1px solid rgba(148,163,184,.3);text-align:left}
    table:not(.cs-table) tbody tr:nth-child(even){background:var(--table-row-even)}
    table:not(.cs-table) tbody tr:hover{background:var(--table-row-hover)}

    /* Home dashboard layout */
    .dashboard-grid{display:grid;grid-template-columns:1fr 380px;gap:18px}
    .section{background:var(--bg-card);border:1px solid var(--border-card);border-radius:16px;padding:16px}
    .ops-card{min-height:280px;max-height:280px;display:flex;flex-direction:column}
    .ops-scroll{overflow:auto;border-radius:10px}

    /* Slot machine */
    .slot-card{text-align:center}
    .slots{display:inline-flex;gap:10px}
    .slot{width:72px;height:92px;border-radius:14px;background:rgba(15,23,42,.9);border:1px solid rgba(148,163,184,.45);position:relative;overflow:hidden;box-shadow:inset 0 -10px 20px rgba(255,255,255,.03)}
    body.light-mode .slot{background:#fff;border-color:#e5e7eb}
    .digit-col{position:absolute;inset:0 0 auto 0;height:920px;transition:transform 1000ms cubic-bezier(.22,1,.36,1)}
    .digit{height:92px;display:grid;place-items:center;font-size:2.35rem;font-weight:800}

    /* Incidents today */
    .sev-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:12px}
    .sev{border:1px solid var(--border-card);border-radius:12px;padding:14px;text-align:center}
    .sev h4{margin:.2rem 0 .6rem;color:var(--text-muted)}
    .sev .n{font-size:1.5rem;font-weight:800}

    /* Availability gauge */
    .gauge{width:100%;height:240px;display:block}
    .g-label{position:absolute;bottom:14px;left:16px;font-size:1.8rem;font-weight:800}
    .gauge-box{position:relative}
    :root{--needle:#ffffff}

    /* Concurrency tiles */
    .customer-concurrency-list{list-style:none;margin:10px 0 0 0;padding:0;display:flex;flex-wrap:wrap;gap:12px}
    .customer-concurrency-item{background:rgba(15,23,42,.85);border:1px solid rgba(148,163,184,.45);padding:10px 12px;border-radius:12px;min-width:150px;display:flex;flex-direction:column;align-items:center;gap:6px}
    body.light-mode .customer-concurrency-item{background:#f0f8ff;border-color:#cfe2ff}
    .customer-logo{height:30px}
    .concurrency-value{font-weight:800;color:var(--accent)}

    .badge{padding:.2em .55em;border-radius:999px;font-weight:600}
    .badge-success{background:rgba(22,163,74,.12);color:#4ade80}
    .badge-danger{background:rgba(220,38,38,.18);color:#fecaca}
    .badge-warning{background:rgba(245,158,11,.18);color:#fed7aa}

    @media(max-width:1000px){.dashboard-grid{grid-template-columns:1fr}}
  </style>
</head>
<body>
  <header>
    <img src="image/Quickplay.jpg" class="logo" alt="Quickplay"/>
    <h1>TechOps 360 - Portal</h1>
    <button id="theme-toggle" class="theme-toggle" type="button" aria-label="Toggle theme">‚òÄÔ∏è Light</button>
  </header>

  <div class="container">
    <div class="tabs">
      <button class="tab-button active" onclick="openTab(event,'Home')">Home</button>
      <button class="tab-button" onclick="openTab(event,'CustomerStats')">Customer Stats</button>
      <button class="tab-button" onclick="openTab(event,'SyntheticMonitoring')">Synthetic Monitoring</button>
      <button class="tab-button" onclick="openTab(event,'ManifestCheck')">Manifest Check</button>
      <button class="tab-button" onclick="openTab(event,'ShiftHandoffs')">Shift Handoffs</button>
      <button class="tab-button" onclick="openTab(event,'RBAC')">RBAC</button>
      <button class="tab-button" onclick="openTab(event,'IssueSearch')">Issue Search</button>
    </div>

    <!-- ========== HOME ========== -->
    <div id="Home" class="tab-content active">
      <div class="dashboard-grid">
        <!-- Center column -->
        <div>
          <!-- Ops Calendar -->
          <div class="section ops-card" style="margin:0;">
            <h2>Operations Calendar (Today)</h2>
            <div class="ops-scroll">
              <table>
                <thead><tr><th>Engineer Name</th><th>Status</th><th>Shift (local time)</th></tr></thead>
                <tbody id="ops-calendar-body"><tr><td colspan="3">Loading schedule‚Ä¶</td></tr></tbody>
              </table>
            </div>
            <p class="meta-note">Current shift status for operations engineers (IST / MYT / EST coverage).</p>
          </div>

          <!-- Slot machine -->
          <div class="section slot-card" style="margin-top:18px;">
            <h2>Total incidents since org inception</h2>
            <div id="slotCounter" class="slots" aria-label="Total incidents animated counter"></div>
            <p class="meta-note">Demo rolls like a slot machine, then settles on today‚Äôs placeholder.</p>
          </div>

          <!-- Incidents today -->
          <div class="section" style="margin-top:18px;">
            <h2>Incidents today</h2>
            <div class="sev-grid">
              <div class="sev"><h4>P1</h4><div id="p1" class="n">1</div></div>
              <div class="sev"><h4>P2</h4><div id="p2" class="n">3</div></div>
              <div class="sev"><h4>P3</h4><div id="p3" class="n">4</div></div>
              <div class="sev"><h4>P4</h4><div id="p4" class="n">6</div></div>
            </div>
          </div>
        </div>

        <!-- Right column -->
        <div>
          <!-- Availability -->
          <div class="section gauge-box" style="margin:0;">
            <h2>Availability</h2>
            <svg id="gauge" class="gauge" viewBox="0 0 360 200" role="img" aria-label="Availability gauge">
              <defs>
                <linearGradient id="ggrad" x1="0%" y1="0%" x2="100%" y2="0%">
                  <stop offset="0%" stop-color="#ef4444"/>
                  <stop offset="50%" stop-color="#f59e0b"/>
                  <stop offset="100%" stop-color="#22c55e"/>
                </linearGradient>
              </defs>
              <path d="M20,180 A160,160 0 0 1 340,180" stroke="rgba(148,163,184,.28)" stroke-width="18" fill="none"/>
              <path id="gArc" d="M20,180 A160,160 0 0 1 340,180" stroke="url(#ggrad)" stroke-width="18" fill="none" stroke-linecap="round" stroke-dasharray="0 503"/>
              <line id="needle" x1="180" y1="180" x2="180" y2="40" stroke="var(--needle)" stroke-width="4" stroke-linecap="round"/>
            </svg>
            <div class="g-label" id="gPct">0%</div>
          </div>

          <!-- Customer Concurrency -->
          <div class="section" style="margin-top:18px;">
            <h2>Customer Concurrency</h2>
            <ul class="customer-concurrency-list" id="cc-list"></ul>
            <p class="meta-note" style="margin-top:.5rem">Representative active concurrency values (demo).</p>
          </div>
        </div>
      </div>
    </div>

    <!-- ========== CUSTOMER STATS ========== -->
    <div id="CustomerStats" class="tab-content">
      <h2>Customer Stats</h2>
      <p class="meta-note" style="text-align:left">App store ratings and customer sentiment derived from app-store comments (last 7 days).</p>
      <div id="customer-sentiment-dashboard"></div>
    </div>

    <!-- ========== SYNTHETIC MONITORING ========== -->
    <div id="SyntheticMonitoring" class="tab-content">
      <h2>Synthetic Monitoring Results (Live Health Checks)</h2>
      <table>
        <thead><tr><th>Service Name</th><th>Component</th><th>SG Status</th><th>HK Status</th><th>Last Checked</th><th>Overall Status</th></tr></thead>
        <tbody>
          <tr><td>admin-search-service</td><td>CMS</td><td>200</td><td>200</td><td>2025-06-09 14:00 IST</td><td><span class="badge badge-success">OK</span></td></tr>
          <tr><td>cms-metadata</td><td>CMS</td><td>200</td><td>200</td><td>2025-06-09 14:00 IST</td><td><span class="badge badge-success">OK</span></td></tr>
          <tr><td>epg-ingestion-tm</td><td>CMS</td><td>401</td><td>503</td><td>2025-06-09 14:00 IST</td><td><span class="badge badge-danger">DOWN</span></td></tr>
          <tr><td>sitemap-generator</td><td>Edge</td><td>200</td><td>200</td><td>2025-06-09 14:00 IST</td><td><span class="badge badge-success">OK</span></td></tr>
          <tr><td>syndication-ingestion-disney</td><td>CMS</td><td>503</td><td>503</td><td>2025-06-09 14:00 IST</td><td><span class="badge badge-danger">DOWN</span></td></tr>
          <tr><td>user-settings-service</td><td>CMS</td><td>200</td><td>200</td><td>2025-06-09 14:00 IST</td><td><span class="badge badge-success">OK</span></td></tr>
        </tbody>
      </table>
      <p class="meta-note" style="text-align:left">Health check statuses directly from service monitoring systems (sample data).</p>
    </div>

    <!-- ========== MANIFEST CHECK ========== -->
    <div id="ManifestCheck" class="tab-content">
      <h2>Manifest Check Results: RSM Channels</h2>
      <table>
        <thead><tr><th>Channel Name</th><th>Protocol</th><th>URL</th><th>Status</th><th>Details</th></tr></thead>
        <tbody>
          <tr><td>snohd</td><td>HLS</td><td>https://live-streaming-tma.live.rsm.firstlight.ai/snohd/snohd.isml/.m3u8</td><td><span class="badge badge-success">OK</span></td><td>Manifest loaded successfully.</td></tr>
          <tr><td>snehd</td><td>HLS</td><td>https://live-streaming-tm.live.rsm.firstlight.ai/snehd/snehd.isml/.m3u8</td><td><span class="badge badge-danger">MISSING_STREAM</span></td><td>Missing audio-only variant.</td></tr>
          <tr><td>wwehd</td><td>DASH</td><td>https://live-streaming-tm.live.rsm.firstlight.ai/wwehd/wwehd_cenc.isml/.mpd</td><td><span class="badge badge-success">OK</span></td><td>Manifest loaded successfully.</td></tr>
        </tbody>
      </table>
      <p class="meta-note" style="text-align:left">Data is a representative subset from <code>RSM_Manifest_URL.txt</code>.</p>
    </div>

    <!-- ========== SHIFT HANDOFFS ========== -->
    <div id="ShiftHandoffs" class="tab-content">
      <h2>Shift Handoffs (Morning)</h2>
      <div class="section" style="margin:0">
        <div class="meta-note" style="text-align:left">Summary provided by Praveen Kumar (sample).</div>
        <ul>
          <li><strong>Incidents opened:</strong> 7 &nbsp;‚Ä¢&nbsp; <strong>Resolved:</strong> 4 &nbsp;‚Ä¢&nbsp; <strong>Updated:</strong> 28</li>
        </ul>
        <h3>Incidents</h3>
        <ul>
          <li><strong>INC0195019:</strong> The customer is facing a loading issue on mobile.</li>
          <li><strong>INC0195023:</strong> [AHA] User already has subscription but sees ‚Äúsubscribe now‚Äù.</li>
        </ul>
        <h3>Changes</h3>
        <ul>
          <li><strong>CHG0102910:</strong> [LocalNow] HLS &amp; EPG URL changes for one Live Channel ‚Äì Completed.</li>
        </ul>
        <h3>Upcoming CR</h3>
        <ul><li><strong>CHG0102882:</strong> [AHA] Web deployment of version.</li></ul>
      </div>
    </div>

    <!-- ========== RBAC ========== -->
    <div id="RBAC" class="tab-content">
      <h2>RBAC (Role-Based Access Control)</h2>
      <table>
        <thead><tr><th>Role</th><th>Description</th><th>Access Level</th></tr></thead>
        <tbody>
          <tr><td>Admin</td><td>Full control over all modules and user management.</td><td>All (View, Edit, Manage Users)</td></tr>
          <tr><td>Operations Lead</td><td>Manage dashboards and team members.</td><td>All (View, Edit on assigned customers)</td></tr>
          <tr><td>Operations Engineer</td><td>View dashboards and execute operational tasks.</td><td>View all, limited Edit</td></tr>
          <tr><td>Viewer</td><td>Read-only access to dashboards.</td><td>View Only</td></tr>
        </tbody>
      </table>
      <p class="meta-note" style="text-align:left">Map these roles to your SSO groups in production.</p>
    </div>

    <!-- ========== ISSUE SEARCH ========== -->
    <div id="IssueSearch" class="tab-content">
      <h2>Issue Resolution Search</h2>
      <input type="text" class="search-input" placeholder="Search past issues (e.g., 'buffer timeout', 'payment gateway error')"/>
      <table>
        <thead><tr><th>Issue ID</th><th>Summary</th><th>Customer</th><th>Date Resolved</th><th>Resolution</th><th>Owner</th></tr></thead>
        <tbody>
          <tr><td>INC0195023</td><td>User has subscription but showing ‚Äúsubscribe now‚Äù.</td><td>Aha</td><td>2025-06-09</td><td>Investigating data sync.</td><td>Praveen K.</td></tr>
          <tr><td>ISSUE-002</td><td>App crash on Android 12.</td><td>PLDT</td><td>2025-04-15</td><td>Hotfix v3.1.1 (memory leak).</td><td>Team Bravo</td></tr>
          <tr><td>ISSUE-003</td><td>Synthetic login test failure.</td><td>RSM</td><td>2025-06-01</td><td>Updated stale credentials.</td><td>Team Alpha</td></tr>
        </tbody>
      </table>
      <p class="meta-note" style="text-align:left">Search is simulated; wire to Elasticsearch/Postgres for production.</p>
    </div>
  </div>

  <!-- Tabs + Theme -->
  <script>
    function openTab(evt, id){
      document.querySelectorAll('.tab-content').forEach(el=>el.classList.remove('active'));
      document.querySelectorAll('.tab-button').forEach(b=>b.classList.remove('active'));
      document.getElementById(id).classList.add('active');
      evt.currentTarget.classList.add('active');
    }
    function applyTheme(mode){
      document.body.classList.toggle('light-mode', mode==='light');
      const btn=document.getElementById('theme-toggle');
      if(document.body.classList.contains('light-mode')){btn.textContent='üåô Dark';btn.setAttribute('aria-label','Switch to dark')}
      else{btn.textContent='‚òÄÔ∏è Light';btn.setAttribute('aria-label','Switch to light')}
    }
    document.addEventListener('DOMContentLoaded',()=>{
      const stored=localStorage.getItem('techops-theme');
      const prefLight=matchMedia('(prefers-color-scheme: light)').matches;
      applyTheme(stored || (prefLight?'light':'dark'));
      document.getElementById('theme-toggle').addEventListener('click',()=>{
        const next=document.body.classList.contains('light-mode')?'dark':'light';
        localStorage.setItem('techops-theme',next);applyTheme(next);
      });
    });
  </script>

  <!-- Home page data: slot machine, gauge, concurrency tiles -->
  <script>
    // Concurrency tiles with your logo paths
    const CUSTOMERS = [
      {name:'Aha', logo:'image/aha_Logo.png', val:'4.5K'},
      {name:'Philippinas Live', logo:'image/PilipinasLive_Logo.png', val:'1.8K'},
      {name:'Cignal', logo:'image/Cignal_Logo.png', val:'2.4K'},
      {name:'Unifi 2.0', logo:'image/Unifi2.0_logo.png', val:'1.1K'},
      {name:'Univision', logo:'image/Univision_logo.webp', val:'2.0K'},
      {name:'Univision Now', logo:'image/UnivisionNow_logo.png', val:'900'},
      {name:'Local Now', logo:'image/LocalNow_Logo.png', val:'700'},
      {name:'TWC (The Weather Channel)', logo:'image/TWC_Logo.png', val:'1.6K'},
      {name:'GOTHAM', logo:'image/GOTHAM_Logo.png', val:'400'},
      {name:'Canela TV', logo:'image/CanelaTV_Logo.png', val:'800'}
    ];
    document.addEventListener('DOMContentLoaded',()=>{
      const ul=document.getElementById('cc-list');
      if(ul){
        CUSTOMERS.forEach(c=>{
          const li=document.createElement('li');li.className='customer-concurrency-item';
          li.innerHTML=`<img class="customer-logo" src="${c.logo}" alt=""><div>${c.name}</div><div class="concurrency-value">${c.val}</div>`;
          ul.appendChild(li);
        });
      }
    });

    // Slot machine - horizontal columns, reliable paint+animate
    (function(){
      const TARGET="654432"; // TODO: wire to live total
      const H=92; const wrap=document.getElementById('slotCounter'); if(!wrap) return;
      function mkCol(d){
        const slot=document.createElement('div');slot.className='slot';
        const col=document.createElement('div');col.className='digit-col';
        for(let i=0;i<10;i++){const e=document.createElement('div');e.className='digit';e.textContent=i;col.appendChild(e);}
        slot.appendChild(col);
        // two rafs ensures first frame renders before animation
        requestAnimationFrame(()=>requestAnimationFrame(()=>{
          const rounds=2+Math.floor(Math.random()*2);
          const end=rounds*10+Number(d);
          col.style.transform=`translateY(-${end*H}px)`;
        }));
        return slot;
      }
      wrap.innerHTML='';
      TARGET.split('').forEach(d=>wrap.appendChild(mkCol(d)));
    })();

    // Gauge animation (theme-aware needle)
    (function(){
      const target=96; // TODO: wire to live %
      const arc=document.getElementById('gArc'); const needle=document.getElementById('needle'); const label=document.getElementById('gPct');
      if(!arc||!needle) return;
      const circumference=503, cx=180, cy=180, len=130;
      const pctToDeg=p=>180-(p*1.8);
      const start=performance.now(), dur=1200;
      function step(now){
        const t=Math.min(1,(now-start)/dur); const e=1-Math.pow(1-t,3); const pct=target*e;
        label.textContent=Math.round(pct)+'%';
        const dash=(pct/100)*circumference; arc.setAttribute('stroke-dasharray',`${dash} ${circumference-dash}`);
        const rad=pctToDeg(pct)*Math.PI/180; const x2=cx+len*Math.cos(rad); const y2=cy-len*Math.sin(rad);
        needle.setAttribute('x2',x2); needle.setAttribute('y2',y2);
        if(t<1) requestAnimationFrame(step);
      }
      requestAnimationFrame(step);
    })();
  </script>

  <!-- Ops calendar (Google Sheets) -->
  <script src="ops-calendar.js?v=3"></script>

  <!-- Customer sentiment dashboard -->
  <script src="customer-sentiment.js?v=3"></script>

  <!-- Botpress Chatbot -->
  <script src="https://cdn.botpress.cloud/webchat/v1/inject.js"></script>
  <script>
    window.botpressWebChat && window.botpressWebChat.init({
      composerPlaceholder:"Chat with TechOps Bot",
      botConversationDescription:"Your AI assistant for TechOps 360",
      botId:"56efefce-fa7c-41e6-9846-ec36c7c6704a",
      hostUrl:"https://cdn.botpress.cloud/webchat/v1",
      messagingUrl:"https://messaging.botpress.cloud",
      clientId:"a7e5af98-3b12-4265-a9f9-6f3fcd500b93",
      lazySocket:true, themeName:"prism", botName:"TechOps Assistant",
      stylesheet:"https://webchat-styler-widgets.botpress.app/prod/v1/themes/prism.css",
      frontendVersion:"v1", useSessionStorage:true, enableConversationDeletion:true,
      theme:"prism", themeColor:"#2563eb"
    });
  </script>
</body>
</html>
