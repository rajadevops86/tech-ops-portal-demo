<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>TechOps 360</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">

<style>
  :root{
    --font:'Inter',system-ui,-apple-system,'Segoe UI',Roboto,sans-serif;

    /* --- Dark theme --- */
    --bg: radial-gradient(1200px 700px at 15% 0%, #1e3a8a 0%, transparent 60%),
          radial-gradient(1200px 700px at 100% 0%, #7c3aed 0%, transparent 60%),
          radial-gradient(1200px 800px at 50% 100%, #ec4899 0%, transparent 60%),
          #0b1221;
    --card-bg: rgba(10,14,25,.9);
    --card-border: rgba(148,163,184,.35);
    --shadow: 0 18px 60px rgba(0,0,0,.45);
    --text:#e7ecf4; --muted:#9aa4b2;
    --pill: rgba(15,23,42,.9); --pill-border: rgba(148,163,184,.5);
    --table-head: rgba(18,24,38,.95);
    --row-alt: rgba(18,24,38,.7);
    --row-hover: rgba(37, 99, 235, .15);
    --tile-bg: rgba(12,18,30,.9);
    --accent:#f97316;

    /* New: severity colors (dark) */
    --sev-p1:#ef4444;
    --sev-p2:#f59e0b;
    --sev-p3:#d97706;
    --sev-p4:#a16207;

    /* Fixed card height so Ops Calendar == Concurrency */
    --card-fixed-h: 392px;
  }
  [data-theme="light"]{
    --bg: radial-gradient(1200px 700px at 15% 0%, #dbeafe 0%, transparent 60%),
          radial-gradient(1200px 700px at 100% 0%, #fde68a 0%, transparent 60%),
          radial-gradient(1200px 800px at 50% 100%, #fef3c7 0%, transparent 60%),
          #f8fafc;
    --card-bg: rgba(255,255,255,.94);
    --card-border: rgba(2,6,23,.12);
    --shadow: 0 18px 50px rgba(2, 6, 23, .08);
    --text:#0f172a; --muted:#475569;
    --pill: rgba(255,255,255,.95); --pill-border: rgba(2,6,23,.12);
    --table-head: rgba(248,250,252,.95);
    --row-alt: rgba(248,250,252,.82);
    --row-hover: rgba(2, 132, 199, .08);
    --tile-bg: rgba(255,255,255,.95);

    /* severity (light friendly) */
    --sev-p1:#b91c1c;
    --sev-p2:#c2410c;
    --sev-p3:#a16207;
    --sev-p4:#854d0e;
  }

  *{box-sizing:border-box}
  body{margin:0;font-family:var(--font);color:var(--text);background:var(--bg);background-attachment:fixed}

  /* Top bar */
  .top{display:flex;align-items:center;justify-content:space-between;padding:16px 22px;position:sticky;top:0;z-index:40;backdrop-filter:blur(14px);background:linear-gradient(to bottom, rgba(12,18,30,.7), rgba(12,18,30,.35), transparent);border-bottom:1px solid var(--card-border)}
  .brand{display:flex;gap:12px;align-items:center}
  .logo{width:40px;height:28px;border-radius:10px;background:#020617;display:grid;place-items:center;box-shadow:inset 0 0 0 1px rgba(255,255,255,.05)}
  .title{font-weight:800;letter-spacing:.2px}
  .sub{font-size:.86rem;color:var(--muted)}
  .pill{display:inline-flex;align-items:center;gap:8px;font-size:.8rem;color:var(--muted);padding:6px 10px;border:1px solid var(--pill-border);background:var(--pill);border-radius:999px}
  .dot{width:7px;height:7px;border-radius:999px;background:#22c55e;box-shadow:0 0 0 4px rgba(34,197,94,.25)}
  .toggle{border:1px solid var(--pill-border);background:var(--pill);border-radius:999px;padding:6px 12px;cursor:pointer;color:var(--text);font-weight:600}

  /* Shell grid */
  .shell{display:grid;grid-template-columns:230px 1fr 380px;gap:18px;padding:18px;max-width:1400px;margin:0 auto}
  @media(max-width:1200px){.shell{grid-template-columns:1fr}.right-col{order:3}}

  /* Side nav */
  .side{background:var(--card-bg);border:1px solid var(--card-border);border-radius:18px;box-shadow:var(--shadow);padding:12px;display:flex;flex-direction:column;gap:8px}
  .side h6{margin:6px 8px;font-size:.7rem;text-transform:uppercase;letter-spacing:.08em;color:var(--muted)}
  .navbtn{display:flex;align-items:center;gap:10px;background:transparent;color:var(--muted);padding:10px 12px;border-radius:12px;border:1px solid transparent;cursor:pointer}
  .navbtn.active,.navbtn:hover{color:var(--text);border-color:var(--card-border);background:var(--row-alt)}
  .hr{height:1px;background:var(--card-border);border:none;margin:6px 0}

  /* Panels + cards */
  .panel{display:none}
  .panel.active{display:block}
  .card{background:var(--card-bg);border:1px solid var(--card-border);border-radius:22px;box-shadow:var(--shadow);padding:14px 16px;position:relative}
  h3{margin:6px 0 10px;font-size:1.08rem}

  .grid-center{display:grid;grid-template-rows:auto auto auto;gap:16px}
  .grid-right{display:grid;grid-template-rows:auto auto;gap:16px}

  /* Tables */
  table{width:100%;border-collapse:collapse;font-size:.9rem}
  thead{background:var(--table-head)}
  th,td{padding:8px 10px;border-bottom:1px solid var(--card-border);text-align:left}
  tbody tr:nth-child(even){background:var(--row-alt)}
  tbody tr:hover{background:var(--row-hover)}

  /* Concurrency section */
  .conc-list{list-style:none;margin:8px 0 0;padding:0;display:flex;flex-direction:column;gap:8px}
  .conc-item{display:flex;align-items:center;justify-content:space-between;gap:10px;padding:8px 10px;border-radius:12px;background:var(--tile-bg);border:1px solid var(--card-border)}
  .conc-left{display:flex;align-items:center;gap:8px}
  .logo-sq{width:26px;height:26px;border-radius:7px;display:grid;place-items:center;overflow:hidden;background:#fff;border:1px solid rgba(2,6,23,.06)}
  .logo-sq img{max-width:100%;max-height:100%;object-fit:contain;display:block}
  .badge{font-size:.78rem;border:1px solid rgba(248,250,252,.35);padding:2px 8px;border-radius:999px;display:inline-flex;gap:6px;align-items:center;background:var(--pill);color:var(--text)}
  .badge .v{color:#facc15;font-weight:800}

  /* Gauge (Availability) */
  .gauge{width:100%;height:240px;display:block}
  .g-title{margin-bottom:8px}
  .g-label{position:absolute;bottom:14px;left:20px;font-size:1.8rem;font-weight:800}

  /* Slot machine */
  .slot-card{display:flex;flex-direction:column;align-items:center;gap:10px;padding-top:18px;padding-bottom:18px}
  .slots{display:flex;gap:10px}
  .slot{width:72px;height:92px;border-radius:14px;background:var(--tile-bg);border:1px solid var(--card-border);overflow:hidden;position:relative;box-shadow:inset 0 -10px 20px rgba(255,255,255,.03)}
  .digit-col{position:absolute;left:0;top:0;width:100%;transition:transform 1100ms cubic-bezier(.22,1,.36,1)}
  .digit{height:92px;display:grid;place-items:center;font-weight:800;font-size:2.35rem;color:var(--text)}
  .slot-sub{font-size:.86rem;color:var(--muted);text-align:center}

  /* Fixed equal heights */
  .fixed-eq { height: var(--card-fixed-h); display:flex; flex-direction:column; }
  .fixed-eq .table-wrap { overflow:auto; margin-top:6px; }

  /* Ops Calendar: ON SHIFT pill */
  .pill-on { display:inline-block; padding:2px 10px; border-radius:999px; font-weight:800; color:#16a34a; border:1px solid rgba(22,163,74,.35); background:rgba(22,163,74,.10); }

  /* Severity colors */
  .sev-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:12px}
  .sev{background:var(--tile-bg);border:1px solid var(--card-border);border-radius:14px;padding:10px;text-align:center}
  .sev h4{margin:2px 0 6px;font-size:.9rem;color:var(--muted)}
  .sev .n{font-size:1.4rem;font-weight:800}
  .sev-p1 .n{color:var(--sev-p1)}
  .sev-p2 .n{color:var(--sev-p2)}
  .sev-p3 .n{color:var(--sev-p3)}
  .sev-p4 .n{color:var(--sev-p4)}

  /* Customer Stats (wide) */
  #panel-cust .card{padding-bottom:8px}
  .app-table{width:100%}
  .detail-wrap{margin-top:14px;display:none}
  .cs-grid{display:grid;grid-template-columns:2fr 1fr;gap:14px}
  .cs-box{background:var(--tile-bg);border:1px solid var(--card-border);border-radius:14px;padding:12px}
  .mini-gauge{width:240px;height:120px}
  .mini-label{font-weight:800;margin-top:6px}
</style>
</head>
<body>

<header class="top">
  <div class="brand">
    <div class="logo"><img src="image/Quickplay.jpg" alt="Quickplay" style="height:18px"></div>
    <div>
      <div class="title">TechOps 360</div>
      <div class="sub">Operational intelligence for Quickplay customers</div>
    </div>
  </div>
  <div>
    <span class="pill"><span class="dot"></span>24Ã—7 follow-the-sun</span>
    <button id="modeToggle" class="toggle" style="margin-left:8px">Light</button>
  </div>
</header>

<div class="shell">
  <!-- SIDE NAV -->
  <aside class="side">
    <h6>Views</h6>
    <button class="navbtn active" data-panel="panel-dashboard">Dashboard</button>
    <button class="navbtn" data-panel="panel-cust">Customer Stats</button>
    <button class="navbtn" data-panel="panel-synth">Synthetic Monitoring</button>
    <button class="navbtn" data-panel="panel-manif">Manifest Check</button>
    <button class="navbtn" data-panel="panel-handoff">Shift Handoffs</button>
    <button class="navbtn" data-panel="panel-rbac">RBAC</button>
    <button class="navbtn" data-panel="panel-issues">Issue Search</button>
    <hr class="hr">
    <div class="sub" style="padding:6px 8px">Internal view. Live: Ops calendar (Google Sheets). Others are placeholders to wire to NR/Grafana/ServiceNow.</div>
  </aside>

  <!-- CENTER PANELS -->
  <main class="panel active" id="panel-dashboard">
    <div class="grid-center">
      <!-- Ops Calendar (fixed height; only ON SHIFT visible) -->
      <section class="card fixed-eq">
        <h3>Operations Calendar (Today)</h3>
        <div class="table-wrap">
          <table>
            <thead><tr><th>Engineer Name</th><th>Status</th><th>Shift (local time)</th></tr></thead>
            <tbody id="ops-calendar-body"><tr><td colspan="3">Loading scheduleâ€¦</td></tr></tbody>
          </table>
        </div>
      </section>

      <!-- Slot machine -->
      <section class="card slot-card">
        <h3 style="text-align:center">Total incidents since org inception</h3>
        <div class="slots" id="slotCounter"></div>
        <div class="slot-sub">Demo rolls like a slot machine, then settles on todayâ€™s placeholder.</div>
      </section>

      <!-- Severity -->
      <section class="card">
        <h3>Incidents today</h3>
        <div class="sev-grid">
          <div class="sev sev-p1"><h4>P1</h4><div class="n" id="p1">1</div></div>
          <div class="sev sev-p2"><h4>P2</h4><div class="n" id="p2">3</div></div>
          <div class="sev sev-p3"><h4>P3</h4><div class="n" id="p3">4</div></div>
          <div class="sev sev-p4"><h4>P4</h4><div class="n" id="p4">6</div></div>
        </div>
      </section>
    </div>
  </main>

  <!-- RIGHT (Dashboard pair) -->
  <aside class="panel active right-col" id="panel-dashboard-right">
    <div class="grid-right">
      <section class="card fixed-eq" id="concCard">
        <h3>Customer concurrency</h3>
        <ul class="conc-list" id="concList">
          <!-- Logos per your exact paths -->
          <li class="conc-item"><div class="conc-left"><div class="logo-sq"><img src="image/aha_Logo.png" alt="Aha"></div><div>Aha</div></div><div class="badge">Live <span class="v">4.5K</span></div></li>
          <li class="conc-item"><div class="conc-left"><div class="logo-sq"><img src="image/PilipinasLive_Logo.png" alt="Philippinas Live"></div><div>Philippinas Live</div></div><div class="badge">Live <span class="v">1.8K</span></div></li>
          <li class="conc-item"><div class="conc-left"><div class="logo-sq"><img src="image/Cignal_Logo.png" alt="Cignal"></div><div>Cignal</div></div><div class="badge">Live <span class="v">2.4K</span></div></li>
          <li class="conc-item"><div class="conc-left"><div class="logo-sq"><img src="image/Unifi2.0_logo.png" alt="Unifi 2.0"></div><div>Unifi 2.0</div></div><div class="badge">Live <span class="v">1.1K</span></div></li>
          <li class="conc-item"><div class="conc-left"><div class="logo-sq"><img src="image/Univision_logo.webp" alt="Univision"></div><div>Univision</div></div><div class="badge">Live <span class="v">2.0K</span></div></li>
          <li class="conc-item"><div class="conc-left"><div class="logo-sq"><img src="image/UnivisionNow_logo.png" alt="Univision Now"></div><div>Univision Now</div></div><div class="badge">Live <span class="v">900</span></div></li>
          <li class="conc-item"><div class="conc-left"><div class="logo-sq"><img src="image/LocalNow_Logo.png" alt="Local Now"></div><div>Local Now</div></div><div class="badge">Live <span class="v">700</span></div></li>
          <li class="conc-item"><div class="conc-left"><div class="logo-sq"><img src="image/TWC_Logo.png" alt="TWC (The Weather Channel)"></div><div>TWC (The Weather Channel)</div></div><div class="badge">Live <span class="v">1.6K</span></div></li>
          <li class="conc-item"><div class="conc-left"><div class="logo-sq"><img src="image/GOTHAM_Logo.png" alt="GOTHAM"></div><div>GOTHAM</div></div><div class="badge">Live <span class="v">400</span></div></li>
          <li class="conc-item"><div class="conc-left"><div class="logo-sq"><img src="image/CanelaTV_Logo.png" alt="Canela TV"></div><div>Canela TV</div></div><div class="badge">Live <span class="v">800</span></div></li>
        </ul>
      </section>

      <section class="card">
        <h3 class="g-title">Availability</h3>
        <svg id="gauge" class="gauge" viewBox="0 0 360 200">
          <defs>
            <linearGradient id="ggrad" x1="0%" y1="0%" x2="100%" y2="0%">
              <stop offset="0%" stop-color="#ef4444"/>
              <stop offset="50%" stop-color="#f59e0b"/>
              <stop offset="100%" stop-color="#22c55e"/>
            </linearGradient>
          </defs>
          <path d="M20,180 A160,160 0 0 1 340,180" stroke="rgba(148,163,184,.28)" stroke-width="18" fill="none"/>
          <path id="gArc" d="M20,180 A160,160 0 0 1 340,180" stroke="url(#ggrad)" stroke-width="18" fill="none" stroke-linecap="round" stroke-dasharray="0 503"/>
          <!-- Needle color adapts in JS for light/dark -->
          <line id="needle" x1="180" y1="180" x2="180" y2="40" stroke="#ffffff" stroke-width="4" stroke-linecap="round"/>
        </svg>
        <div class="g-label" id="gPct">96%</div>
      </section>
    </div>
  </aside>

  <!-- CUSTOMER STATS (wide overview + lazy details) -->
  <main class="panel" id="panel-cust">
    <section class="card">
      <h3>Customer Stats</h3>
      <table class="app-table" id="appTable">
        <thead><tr><th>Customer</th><th>iOS rating</th><th>Android rating</th><th>Customer sentiment (0â€“1)</th></tr></thead>
        <tbody></tbody>
      </table>

      <div class="detail-wrap" id="csDetail">
        <div class="cs-grid">
          <div class="cs-box">
            <h4 style="margin:0 0 8px">Top positive comments (last 7 days)</h4>
            <ol id="posList" style="margin:0;padding-left:18px"></ol>
            <h4 style="margin:12px 0 8px">Top negative comments (last 7 days)</h4>
            <ol id="negList" style="margin:0;padding-left:18px"></ol>
          </div>
          <div class="cs-box" style="display:flex;flex-direction:column;align-items:center">
            <h4 style="margin:0 0 6px">Customer sentiment</h4>
            <svg class="mini-gauge" viewBox="0 0 180 100">
              <defs>
                <linearGradient id="mgrad" x1="0%" y1="0%" x2="100%" y2="0%">
                  <stop offset="0%" stop-color="#ef4444"/>
                  <stop offset="50%" stop-color="#f59e0b"/>
                  <stop offset="100%" stop-color="#22c55e"/>
                </linearGradient>
              </defs>
              <path d="M10,90 A80,80 0 0 1 170,90" stroke="rgba(148,163,184,.28)" stroke-width="12" fill="none"/>
              <path id="mArc" d="M10,90 A80,80 0 0 1 170,90" stroke="url(#mgrad)" stroke-width="12" fill="none" stroke-linecap="round" stroke-dasharray="0 251"/>
              <line id="mNeedle" x1="90" y1="90" x2="90" y2="20" stroke="#fff" stroke-width="3" stroke-linecap="round"/>
            </svg>
            <div class="mini-label" id="mLbl">0.58</div>
          </div>
        </div>
      </div>
    </section>
  </main>

  <!-- OTHER PANELS (unchanged placeholders) -->
  <main class="panel" id="panel-synth"><section class="card"><h3>Synthetic Monitoring</h3><p class="sub">Placeholder for checks table / charts.</p></section></main>
  <main class="panel" id="panel-manif"><section class="card"><h3>Manifest Check</h3><p class="sub">Placeholder for manifest results.</p></section></main>
  <main class="panel" id="panel-handoff"><section class="card"><h3>Shift Handoffs</h3><p class="sub">Placeholder for handoff notes.</p></section></main>
  <main class="panel" id="panel-rbac"><section class="card"><h3>RBAC</h3><p class="sub">Placeholder for roles matrix.</p></section></main>
  <main class="panel" id="panel-issues"><section class="card"><h3>Issue Search</h3><p class="sub">Placeholder for incident memory search.</p></section></main>
</div>

<!-- THEME TOGGLE -->
<script>
  (function(){
    const root=document.documentElement,btn=document.getElementById('modeToggle');
    const saved=localStorage.getItem('techops-theme');
    if(saved){root.setAttribute('data-theme',saved);btn.textContent=saved==='dark'?'Light':'Dark'}
    btn.addEventListener('click',()=>{
      const cur=root.getAttribute('data-theme')||'dark';
      const next=cur==='dark'?'light':'dark';
      root.setAttribute('data-theme',next);btn.textContent=next==='dark'?'Light':'Dark';
      localStorage.setItem('techops-theme',next);
      // needle contrast tweak
      document.getElementById('needle').setAttribute('stroke', next==='dark' ? '#ffffff' : '#111827');
      document.getElementById('mNeedle').setAttribute('stroke', next==='dark' ? '#ffffff' : '#111827');
    });
  })();
</script>

<!-- MENU ROUTER -->
<script>
  (function(){
    const nav = Array.from(document.querySelectorAll('.navbtn'));
    const panels = {
      'panel-dashboard': document.getElementById('panel-dashboard'),
      'panel-dashboard-right': document.getElementById('panel-dashboard-right'),
      'panel-cust': document.getElementById('panel-cust'),
      'panel-synth': document.getElementById('panel-synth'),
      'panel-manif': document.getElementById('panel-manif'),
      'panel-handoff': document.getElementById('panel-handoff'),
      'panel-rbac': document.getElementById('panel-rbac'),
      'panel-issues': document.getElementById('panel-issues'),
    };
    function show(id){
      Object.values(panels).forEach(p=>p.classList.remove('active'));
      if(id==='panel-dashboard'){panels['panel-dashboard'].classList.add('active');panels['panel-dashboard-right'].classList.add('active');}
      else{panels[id].classList.add('active');}
    }
    nav.forEach(btn=>{
      btn.addEventListener('click',()=>{
        nav.forEach(b=>b.classList.remove('active'));
        btn.classList.add('active');
        show(btn.dataset.panel);
      });
    });
  })();
</script>

<!-- OPS CALENDAR (only ON SHIFT shown; fixed height equal to concurrency card) -->
<script>
  (function(){
    const rowsDemo = [
      {name:'Rangasree Dhanvanth', status:'Working', start:'10:00 AM', end:'7:00 PM', tz:'IST'},
      {name:'Sivaprakash Ravi',     status:'Working', start:'1:00 PM',  end:'10:00 PM', tz:'IST'},
      {name:'Hema Sai',             status:'PTO',     start:'',         end:'',        tz:''},     // hidden
      {name:'Alex North',           status:'Off',     start:'',         end:'',        tz:''},     // hidden
    ];
    const tbody = document.getElementById('ops-calendar-body');
    const onShift = rowsDemo.filter(r => r.status.toLowerCase()==='working');
    tbody.innerHTML = onShift.length ? onShift.map(r => `
      <tr>
        <td>${r.name}</td>
        <td><span class="pill-on">ON&nbsp;SHIFT</span></td>
        <td>${r.start} â€“ ${r.end} ${r.tz}</td>
      </tr>`).join('') : `<tr><td colspan="3">No engineers on shift right now.</td></tr>`;

    // Hard lock Ops card height to match concurrency card
    const eq = getComputedStyle(document.documentElement).getPropertyValue('--card-fixed-h');
    document.querySelectorAll('.fixed-eq').forEach(el=>el.style.height = eq);
  })();
</script>

<!-- SLOT MACHINE (digits persist after animation) -->
<script>
  (function(){
    const TARGET="654432"; // demo placeholder
    const H=92;            // must match .digit height
    const wrap=document.getElementById('slotCounter');
    wrap.innerHTML='';

    function makeCol(finalDigit){
      const slot=document.createElement('div'); slot.className='slot';
      const col=document.createElement('div');  col.className='digit-col';
      // build digits 0..9 repeated 3 cycles so spin looks real
      for(let cycle=0; cycle<3; cycle++){
        for(let i=0;i<10;i++){
          const d=document.createElement('div'); d.className='digit'; d.textContent=i; col.appendChild(d);
        }
      }
      // final row with the end digit so we stop exactly on it
      const last=document.createElement('div'); last.className='digit'; last.textContent=finalDigit; col.appendChild(last);
      slot.appendChild(col);

      // ensure first paint shows digits, then animate
      requestAnimationFrame(()=>requestAnimationFrame(()=>{
        const endIndex=30 + Number(finalDigit); // 3 cycles (0..29) + final
        col.style.transform=`translateY(-${endIndex*H}px)`;
      }));

      // after transition, clamp content to just the final digit to prevent browser reflow oddities
      col.addEventListener('transitionend', ()=>{
        col.style.transition='none';
        col.style.transform=`translateY(-${(30 + Number(finalDigit))*H}px)`; // sticky
      }, {once:true});

      return slot;
    }
    TARGET.split('').forEach(d => wrap.appendChild(makeCol(d)));
  })();
</script>

<!-- AVAILABILITY GAUGE -->
<script>
  (function(){
    const targetPct=96;
    const path=document.getElementById('gArc');
    const needle=document.getElementById('needle');
    const label=document.getElementById('gPct');
    const circumference=503, cx=180, cy=180, len=130;
    const start=performance.now(), dur=1200;
    const pctToDeg=p=>180-(p*1.8);
    function step(now){
      const t=Math.min(1,(now-start)/dur), eased=1-Math.pow(1-t,3), pct=targetPct*eased;
      label.textContent=Math.round(pct)+'%';
      const dash=(pct/100)*circumference; path.setAttribute('stroke-dasharray',`${dash} ${circumference-dash}`);
      const rad=pctToDeg(pct)*Math.PI/180, x2=cx+len*Math.cos(rad), y2=cy-len*Math.sin(rad);
      needle.setAttribute('x2',x2); needle.setAttribute('y2',y2);
      if(t<1) requestAnimationFrame(step);
    }
    // needle contrast for current theme
    const theme = document.documentElement.getAttribute('data-theme') || 'dark';
    needle.setAttribute('stroke', theme==='dark' ? '#ffffff' : '#111827');
    requestAnimationFrame(step);
  })();
</script>

<!-- CUSTOMER STATS: overview first; details on row click with mini gauge -->
<script>
  (function(){
    const apps = [
      {name:'Aha', ios:4.36, android:4.62, sentiment:0.58,
       pos:['excellent ðŸ‘ŒðŸ‘','great app!','Just pay and watch very good.','No ads, smooth streaming','Awesome collection'],
       neg:['Keeps lagging. Premium subscription but bad service.','Worst app ever.','Reached streaming limit error','Search is slow on TV','Buffering on mobile']},
      {name:'Cignal', ios:4.28, android:4.5, sentiment:0.61,
       pos:['HD channels look crisp','Reliable live playback','App UI improved','Chromecast works well','Good customer support'],
       neg:['Occasional audio drops','Login issues at peak','Channel list not updated','Ads too frequent','Subtitle mismatch']},
      {name:'Philippinas Live', ios:4.2, android:4.4, sentiment:0.55,
       pos:['Loved the local content','Easy to navigate','Fast loading','Affordable','Clear audio'],
       neg:['Crashes sometimes','Chromecast fails randomly','Geo block confusion','Account linking slow','Payment retry bug']},
    ];

    const tbody = document.querySelector('#appTable tbody');
    tbody.innerHTML = apps.map((a,i)=>`
      <tr data-i="${i}" style="cursor:pointer">
        <td>${a.name}</td>
        <td>${a.ios.toFixed(2)}</td>
        <td>${a.android.toFixed(2)}</td>
        <td>${a.sentiment.toFixed(2)}</td>
      </tr>`).join('');

    const detail = document.getElementById('csDetail');
    const posList=document.getElementById('posList');
    const negList=document.getElementById('negList');
    const mArc=document.getElementById('mArc');
    const mNeedle=document.getElementById('mNeedle');
    const mLbl=document.getElementById('mLbl');
    // needle theme contrast
    const theme = document.documentElement.getAttribute('data-theme') || 'dark';
    mNeedle.setAttribute('stroke', theme==='dark' ? '#ffffff' : '#111827');

    function showDetails(a){
      posList.innerHTML = a.pos.slice(0,5).map(t=>`<li>${t}</li>`).join('');
      negList.innerHTML = a.neg.slice(0,5).map(t=>`<li>${t}</li>`).join('');
      mLbl.textContent = a.sentiment.toFixed(2);

      // animate mini gauge (0..1)
      const target = Math.max(0, Math.min(1, a.sentiment));
      const circumference = 251; // arc length
      const start=performance.now(), dur=800;
      function step(now){
        const t=Math.min(1,(now-start)/dur), eased=1-Math.pow(1-t,3), val=target*eased;
        const dash = val*circumference;
        mArc.setAttribute('stroke-dasharray', `${dash} ${circumference-dash}`);
        const deg = 180-(val*180);
        const rad = deg*Math.PI/180;
        const cx=90, cy=90, len=60;
        const x2=cx+len*Math.cos(rad), y2=cy-len*Math.sin(rad);
        mNeedle.setAttribute('x2',x2); mNeedle.setAttribute('y2',y2);
        if(t<1) requestAnimationFrame(step);
      }
      detail.style.display='block';
      requestAnimationFrame(step);
    }

    tbody.addEventListener('click', (e)=>{
      const tr = e.target.closest('tr[data-i]'); if(!tr) return;
      const app = apps[Number(tr.dataset.i)];
      showDetails(app);
    });
  })();
</script>

</body>
</html>
